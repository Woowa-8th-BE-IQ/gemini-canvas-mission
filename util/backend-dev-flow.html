<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEVFLOW IQ - Backend DevFlow v6</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* 기본 폰트 설정 및 텍스트 선택 색상 (React 버전과 동일) */
    body { font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    ::selection { background-color: #d1fae5; color: #064e3b; } /* selection:bg-emerald-100 */

    /* 스크롤바 커스텀 (선택사항, 깔끔한 UI를 위해 추가) */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 flex flex-col antialiased">

<!-- Header -->
<header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-20">
  <div class="max-w-5xl mx-auto px-4 h-14 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="p-1.5 bg-emerald-600 rounded-lg text-white shadow-lg shadow-emerald-500/20">
        <i data-lucide="terminal" width="18" height="18"></i>
      </div>
      <h1 class="font-black text-sm tracking-tight">DEVFLOW <span class="text-emerald-600 font-bold ml-1">IQ</span></h1>
    </div>
    <div class="flex items-center gap-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">
      <div class="flex items-center gap-1.5 bg-orange-50 px-2 py-1 rounded-md text-orange-600 font-bold">
        <i data-lucide="flame" width="12" height="12" class="fill-current"></i> 14 Day Streak
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="max-w-5xl mx-auto px-4 py-6 flex-grow w-full">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-5">

    <!-- Left Column -->
    <div class="md:col-span-4 space-y-5">
      <!-- 1. Mission Progress Card -->
      <div class="bg-slate-900 text-white rounded-2xl shadow-sm border border-slate-700 p-5 overflow-hidden relative">
        <div class="absolute top-0 right-0 p-4">
          <button id="mission-toggle-btn" class="text-slate-500 hover:text-emerald-400 transition-colors">
            <i data-lucide="settings" width="18" height="18" id="mission-toggle-icon"></i>
          </button>
        </div>

        <!-- Edit Mode -->
        <div id="mission-edit" class="space-y-3 pt-2 hidden">
          <label class="text-[10px] font-bold text-slate-500 uppercase">Mission Title</label>
          <input id="mission-input-title" class="w-full bg-slate-800 border-none rounded p-2 text-sm text-white outline-none focus:ring-1 focus:ring-emerald-500" />

          <label class="text-[10px] font-bold text-slate-500 uppercase">Description</label>
          <input id="mission-input-desc" class="w-full bg-slate-800 border-none rounded p-2 text-sm text-slate-400 outline-none focus:ring-1 focus:ring-emerald-500" />

          <label class="text-[10px] font-bold text-slate-500 uppercase">PR Link</label>
          <input id="mission-input-link" class="w-full bg-slate-800 border-none rounded p-2 text-sm text-emerald-400 outline-none focus:ring-1 focus:ring-emerald-500" />

          <button id="mission-save-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs mt-2 flex justify-center items-center gap-2">
            저장 완료
          </button>
        </div>

        <!-- View Mode -->
        <div id="mission-view">
          <div class="flex items-center gap-2 mb-1">
            <i data-lucide="repeat" width="14" height="14" class="text-emerald-500"></i>
            <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Live Progress</span>
          </div>
          <h2 id="mission-title" class="text-xl font-black mb-1"></h2>
          <p id="mission-desc" class="text-slate-400 text-xs mb-4"></p>

          <div class="mb-6">
            <div class="flex justify-between text-[10px] font-bold mb-1.5 uppercase tracking-tighter">
              <span class="text-slate-500">Overall Completion</span>
              <span class="text-emerald-400" id="progress-text">0%</span>
            </div>
            <div class="h-1.5 w-full bg-slate-800 rounded-full overflow-hidden">
              <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-700 ease-out" style="width: 0%"></div>
            </div>
          </div>

          <div class="space-y-2 mb-6">
            <p class="text-[10px] font-bold text-slate-600 uppercase mb-2">Recent Milestones</p>
            <div id="recent-milestones-list">
              <!-- JS Injected -->
            </div>
            <p id="more-milestones-text" class="text-[10px] text-slate-500 italic hidden"></p>
          </div>

          <a id="mission-link" href="#" target="_blank" rel="noreferrer" class="flex items-center justify-center gap-2 w-full bg-emerald-600 hover:bg-emerald-500 py-3 rounded-xl font-bold text-xs transition-all shadow-lg shadow-emerald-900/20 text-white">
            <i data-lucide="github" width="16" height="16"></i> PR 및 피드백 확인 <i data-lucide="external-link" width="12" height="12"></i>
          </a>
        </div>
      </div>

      <!-- 4. Pomodoro -->
      <div class="bg-emerald-50/30 rounded-2xl shadow-sm border border-emerald-100 p-5 flex flex-col items-center justify-center">
        <div class="flex justify-between items-center w-full mb-2">
          <span class="text-[10px] font-black text-emerald-600 uppercase">Relay Timer</span>
          <button id="timer-reset-btn" class="text-slate-400 hover:text-emerald-600 transition-colors">
            <i data-lucide="rotate-ccw" width="14" height="14"></i>
          </button>
        </div>
        <div id="timer-display" class="text-5xl font-mono font-black text-slate-800 tabular-nums">
          05:00
        </div>
        <button id="timer-toggle-btn" class="w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs flex justify-center items-center gap-2">
          <i data-lucide="play" width="16" height="16" id="timer-icon"></i>
        </button>
      </div>

      <!-- Peer Insight Card -->
      <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-2xl shadow-sm border-none p-5">
        <div class="flex justify-between items-start mb-2">
          <h4 class="text-[10px] font-black uppercase opacity-50">Peer Insight</h4>
          <i data-lucide="users" width="14" height="14" class="text-emerald-400"></i>
        </div>
        <p class="text-sm font-bold leading-relaxed">
          "혼자 만들면 자기 관점에 갇히기 쉽습니다. 페어의 프롬프트에서 새로운 전략을 배워보세요."
        </p>
      </div>
    </div>

    <!-- Right Column -->
    <div class="md:col-span-8 space-y-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">

        <!-- 2. Unified Checklist -->
        <div class="sm:col-span-1">
          <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 h-full flex flex-col">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-black flex items-center gap-2">
                <i data-lucide="check-circle-2" width="20" height="20" class="text-emerald-500"></i> 통합 진행 가이드
              </h2>
              <span id="checklist-count" class="text-[10px] px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full font-black">
                                    0 / 0
                                </span>
            </div>
            <div class="flex gap-2 mb-4">
              <input id="milestone-input" class="flex-1 text-sm bg-slate-50 rounded-lg px-3 py-2 outline-none focus:ring-1 focus:ring-emerald-500 border border-slate-100" placeholder="가이드 항목 또는 개인 목표 추가..." />
              <button id="milestone-add-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs flex items-center justify-center">
                <i data-lucide="plus" width="18" height="18"></i>
              </button>
            </div>
            <div id="milestones-container" class="space-y-2 overflow-y-auto flex-1 max-h-[400px] pr-1">
              <!-- JS Injected -->
            </div>
          </div>
        </div>

        <div class="sm:col-span-1 space-y-5 flex flex-col">
          <!-- 3. Keyword Tracker -->
          <div class="bg-white rounded-2xl shadow-sm border-dashed border-2 border-slate-200 p-5 h-full">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
              <i data-lucide="hash" width="20" height="20" class="text-emerald-500"></i> 공유 키워드
            </h2>
            <div class="flex gap-2 mb-4">
              <input id="keyword-input" class="flex-1 text-sm bg-slate-50 border border-slate-100 rounded-lg p-2 outline-none focus:ring-1 focus:ring-emerald-500" placeholder="프롬프트 팁..." />
              <button id="keyword-add-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs flex items-center justify-center">
                <i data-lucide="plus" width="18" height="18"></i>
              </button>
            </div>
            <div id="keywords-container" class="flex flex-wrap gap-2">
              <!-- JS Injected -->
            </div>
          </div>

          <!-- 5. TIL Log -->
          <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 h-full">
            <h2 class="text-lg font-black mb-4 flex items-center gap-2">
              <i data-lucide="book-open" width="20" height="20" class="text-emerald-500"></i> 배움 & 회고
            </h2>
            <input id="til-input-text" class="w-full text-sm bg-slate-50 rounded-lg p-2 mb-2 border border-slate-100 outline-none focus:ring-1 focus:ring-emerald-500" placeholder="무엇을 배웠나요?" />
            <div class="flex gap-2 mb-4">
              <input id="til-input-link" class="flex-1 text-[11px] bg-slate-50 rounded-lg p-2 border border-slate-100 outline-none focus:ring-1 focus:ring-emerald-500" placeholder="링크 (선택)" />
              <button id="til-add-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs">
                저장
              </button>
            </div>
            <div id="til-container" class="space-y-3 max-h-[250px] overflow-y-auto pr-1">
              <!-- JS Injected -->
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="max-w-5xl mx-auto px-4 py-6 text-center text-slate-400 text-[10px] font-bold border-t border-slate-200 uppercase tracking-widest w-full">
  Woowacourse 2026 - IQ Dash v6.0
</footer>

<!-- Application Logic (Vanilla JS) -->
<script>
  // --- Local Storage Helpers ---
  const saveToStorage = (key, data) => localStorage.setItem(`devflow_v6_${key}`, JSON.stringify(data));
  const getFromStorage = (key, defaultValue) => {
    const saved = localStorage.getItem(`devflow_v6_${key}`);
    return saved ? JSON.parse(saved) : defaultValue;
  };

  // --- Global State ---
  let state = {
    mission: getFromStorage('mission', {
      title: '페어 프롬프트 릴레이',
      desc: '웹 백엔드 레벨 1 - 아이큐(한동희)',
      prLink: 'https://github.com/woowacourse'
    }),
    milestones: getFromStorage('milestones', [
      { id: 1, text: '페어와 주제 선정 (둘 다 쓸 수 있는 앱)', completed: false },
      { id: 2, text: '5분 교대 릴레이 (프롬프터 vs 내비게이터)', completed: false },
      { id: 3, text: '데모데이 그룹 내 시연 및 AI 경험 공유', completed: false },
      { id: 4, text: '피드백 중 "딱 하나" 골라 개선하기', completed: false },
      { id: 5, text: '최종 결과물 배포 및 회고 작성', completed: false }
    ]),
    keywords: getFromStorage('keywords', [
      { id: 1, text: 'Gemini Canvas', level: 1 },
      { id: 2, text: 'Prompt Strategy', level: 2 }
    ]),
    tils: getFromStorage('tils_v6', []),

    // UI States
    isEditingMission: false,
    timer: {
      min: getFromStorage('timer_min', 5),
      m: 5,
      s: 0,
      active: false,
      interval: null
    }
  };

  // --- Render Functions ---

  // 1. Mission Progress
  function renderMission() {
    // Update Text
    document.getElementById('mission-title').textContent = state.mission.title;
    document.getElementById('mission-desc').textContent = state.mission.desc;
    document.getElementById('mission-link').href = state.mission.prLink;

    // Inputs
    document.getElementById('mission-input-title').value = state.mission.title;
    document.getElementById('mission-input-desc').value = state.mission.desc;
    document.getElementById('mission-input-link').value = state.mission.prLink;

    // View/Edit Toggle
    const viewEl = document.getElementById('mission-view');
    const editEl = document.getElementById('mission-edit');
    const iconEl = document.getElementById('mission-toggle-icon');

    if (state.isEditingMission) {
      viewEl.classList.add('hidden');
      editEl.classList.remove('hidden');
      iconEl.setAttribute('data-lucide', 'x');
    } else {
      viewEl.classList.remove('hidden');
      editEl.classList.add('hidden');
      iconEl.setAttribute('data-lucide', 'settings');
    }

    renderProgress();
    lucide.createIcons();
  }

  // 1-1. Progress & Recent Milestones
  function renderProgress() {
    const total = state.milestones.length;
    const completed = state.milestones.filter(m => m.completed).length;
    const progress = total > 0 ? Math.round((completed / total) * 100) : 0;

    document.getElementById('progress-text').textContent = `${progress}%`;
    document.getElementById('progress-bar').style.width = `${progress}%`;
    document.getElementById('checklist-count').textContent = `${completed} / ${total}`;

    // Recent Milestones
    const recentContainer = document.getElementById('recent-milestones-list');
    recentContainer.innerHTML = state.milestones.slice(0, 3).map(m => `
                <div class="flex items-center gap-2 text-xs cursor-pointer group mb-2" onclick="toggleMilestone(${m.id})">
                    <i data-lucide="check-circle-2" width="14" height="14" class="${m.completed ? 'text-emerald-500' : 'text-slate-700'}"></i>
                    <span class="${m.completed ? 'line-through text-slate-600' : 'text-slate-300'}">${m.text}</span>
                </div>
            `).join('');

    const moreText = document.getElementById('more-milestones-text');
    if (state.milestones.length > 3) {
      moreText.textContent = `+ ${state.milestones.length - 3} more in checklist`;
      moreText.classList.remove('hidden');
    } else {
      moreText.classList.add('hidden');
    }
  }

  // 2. Checklist
  function renderChecklist() {
    const container = document.getElementById('milestones-container');
    container.innerHTML = state.milestones.map(m => `
                <div class="group flex items-center justify-between p-3 rounded-xl border border-slate-100 hover:bg-slate-50 transition-all cursor-pointer" onclick="toggleMilestone(${m.id})">
                    <div class="flex items-center gap-3">
                        <div class="w-5 h-5 rounded-md border flex items-center justify-center transition-colors ${m.completed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-300'}">
                            ${m.completed ? `<i data-lucide="check-circle-2" width="12" height="12" class="text-white"></i>` : ''}
                        </div>
                        <span class="text-sm transition-all ${m.completed ? 'line-through text-slate-400' : 'font-medium text-slate-700'}">${m.text}</span>
                    </div>
                    <button onclick="event.stopPropagation(); removeMilestone(${m.id});" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-rose-500 transition-opacity">
                        <i data-lucide="trash-2" width="14" height="14"></i>
                    </button>
                </div>
            `).join('');

    renderProgress(); // Update progress bar as well
    lucide.createIcons();
  }

  // 3. Keywords
  function renderKeywords() {
    const container = document.getElementById('keywords-container');
    container.innerHTML = state.keywords.map(k => {
      let colorClasses = '';
      if (k.level === 3) colorClasses = 'bg-rose-100 text-rose-700';
      else if (k.level === 2) colorClasses = 'bg-amber-100 text-amber-700';
      else colorClasses = 'bg-slate-100 text-slate-600';

      return `
                    <div class="group relative flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold cursor-pointer transition-all ${colorClasses}" onclick="cycleKeyword(${k.id})">
                        ${k.text}
                        <button onclick="event.stopPropagation(); removeKeyword(${k.id});" class="ml-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <i data-lucide="x" width="10" height="10"></i>
                        </button>
                    </div>
                `;
    }).join('');
    lucide.createIcons();
  }

  // 4. TILs
  function renderTILs() {
    const container = document.getElementById('til-container');
    container.innerHTML = state.tils.map(l => `
                <div class="flex gap-3 text-sm group">
                    <span class="text-[10px] font-bold text-slate-400 pt-1 shrink-0">${l.date}</span>
                    <div class="flex-1 flex items-center gap-2">
                        <p class="text-slate-700">${l.text}</p>
                        ${l.link ? `<a href="${l.link}" target="_blank" class="text-emerald-500 hover:text-emerald-600"><i data-lucide="external-link" width="12" height="12"></i></a>` : ''}
                    </div>
                    <button onclick="removeTIL(${l.id})" class="opacity-0 group-hover:opacity-100 text-rose-500 transition-opacity">
                        <i data-lucide="x" width="12" height="12"></i>
                    </button>
                </div>
            `).join('');
    lucide.createIcons();
  }

  // 5. Timer
  function renderTimer() {
    const display = document.getElementById('timer-display');
    display.textContent = `${String(state.timer.m).padStart(2, '0')}:${String(state.timer.s).padStart(2, '0')}`;

    const btn = document.getElementById('timer-toggle-btn');
    const icon = document.getElementById('timer-icon');

    if (state.timer.active) {
      btn.className = 'w-full mt-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-bold transition-all px-2 py-1 text-xs flex justify-center items-center gap-2';
      icon.setAttribute('data-lucide', 'pause');
    } else {
      btn.className = 'w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all px-2 py-1 text-xs flex justify-center items-center gap-2';
      icon.setAttribute('data-lucide', 'play');
    }
    lucide.createIcons();
  }


  // --- Actions / Handlers ---

  // Mission Edit
  document.getElementById('mission-toggle-btn').addEventListener('click', () => {
    state.isEditingMission = !state.isEditingMission;
    renderMission();
  });

  document.getElementById('mission-save-btn').addEventListener('click', () => {
    state.mission.title = document.getElementById('mission-input-title').value;
    state.mission.desc = document.getElementById('mission-input-desc').value;
    state.mission.prLink = document.getElementById('mission-input-link').value;
    state.isEditingMission = false;
    saveToStorage('mission', state.mission);
    renderMission();
  });

  // Milestones
  window.toggleMilestone = (id) => {
    state.milestones = state.milestones.map(m => m.id === id ? { ...m, completed: !m.completed } : m);
    saveToStorage('milestones', state.milestones);
    renderChecklist();
    renderMission(); // Update recent milestones in summary
  };

  window.removeMilestone = (id) => {
    state.milestones = state.milestones.filter(m => m.id !== id);
    saveToStorage('milestones', state.milestones);
    renderChecklist();
    renderMission();
  };

  const addMilestone = () => {
    const input = document.getElementById('milestone-input');
    const val = input.value.trim();
    if (!val) return;
    state.milestones.push({ id: Date.now(), text: val, completed: false });
    input.value = '';
    saveToStorage('milestones', state.milestones);
    renderChecklist();
    renderMission();
  };
  document.getElementById('milestone-add-btn').addEventListener('click', addMilestone);
  document.getElementById('milestone-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') addMilestone(); });

  // Keywords
  window.cycleKeyword = (id) => {
    state.keywords = state.keywords.map(k => k.id === id ? { ...k, level: (k.level % 3) + 1 } : k);
    saveToStorage('keywords', state.keywords);
    renderKeywords();
  };

  window.removeKeyword = (id) => {
    state.keywords = state.keywords.filter(k => k.id !== id);
    saveToStorage('keywords', state.keywords);
    renderKeywords();
  };

  const addKeyword = () => {
    const input = document.getElementById('keyword-input');
    const val = input.value.trim();
    if (!val) return;
    state.keywords.push({ id: Date.now(), text: val, level: 1 });
    input.value = '';
    saveToStorage('keywords', state.keywords);
    renderKeywords();
  };
  document.getElementById('keyword-add-btn').addEventListener('click', addKeyword);
  document.getElementById('keyword-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') addKeyword(); });

  // TILs
  window.removeTIL = (id) => {
    state.tils = state.tils.filter(l => l.id !== id);
    saveToStorage('tils_v6', state.tils);
    renderTILs();
  };

  const addTIL = () => {
    const inputTxt = document.getElementById('til-input-text');
    const inputLnk = document.getElementById('til-input-link');
    if (!inputTxt.value.trim()) return;

    const newDate = new Date().toLocaleDateString('ko-KR').slice(5, 10);
    state.tils.unshift({ id: Date.now(), text: inputTxt.value, link: inputLnk.value, date: newDate });

    inputTxt.value = '';
    inputLnk.value = '';
    saveToStorage('tils_v6', state.tils);
    renderTILs();
  };
  document.getElementById('til-add-btn').addEventListener('click', addTIL);
  document.getElementById('til-input-text').addEventListener('keypress', (e) => { if (e.key === 'Enter') addTIL(); });
  document.getElementById('til-input-link').addEventListener('keypress', (e) => { if (e.key === 'Enter') addTIL(); });

  // Timer Logic
  const toggleTimer = () => {
    state.timer.active = !state.timer.active;

    if (state.timer.active) {
      state.timer.interval = setInterval(() => {
        if (state.timer.s > 0) {
          state.timer.s--;
        } else if (state.timer.m > 0) {
          state.timer.m--;
          state.timer.s = 59;
        } else {
          state.timer.active = false;
          clearInterval(state.timer.interval);
        }
        renderTimer();
      }, 1000);
    } else {
      clearInterval(state.timer.interval);
    }
    renderTimer();
  };

  const resetTimer = () => {
    state.timer.active = false;
    clearInterval(state.timer.interval);
    state.timer.m = state.timer.min;
    state.timer.s = 0;
    renderTimer();
  };

  document.getElementById('timer-toggle-btn').addEventListener('click', toggleTimer);
  document.getElementById('timer-reset-btn').addEventListener('click', resetTimer);


  // --- Initialization ---
  function init() {
    lucide.createIcons(); // Init base icons in HTML
    renderMission();
    renderChecklist();
    renderKeywords();
    renderTILs();
    renderTimer();
  }

  // Run on load
  document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>
